<!DOCTYPE html>
<html>

<head>
  <style>
    div {
      margin-bottom: 0.5em;
    }
  </style>
</head>

<body>
  <div id="main-toolbar">
    <button id="btn-delete" title="Delete selected files">Delete</button>
  </div>
  <hr />
  <div id="file-info">
    <strong>Selected file:</strong>
    <div id="sel-name">(none)</div>
    <div id="sel-path" style="font-family: Consolas, monospace; font-size: 12px; color: #444">(no path)</div>
  </div>
  <div id="file-actions">
    <form onsubmit="submitForm(event)">
      <input type="text" name="toSend" placeholder="text to send"></input>
      <button type="submit">Submit</button>
    </form>
  </div>
  <script type="module">
    // script type="module" so we can use await

    // Set up a form submission function to pass the values to AHK
    window.submitForm = async function ( event ) {
      event.preventDefault();
      await ahk.global.SubmitForm( {
        toSend: event.target.querySelector( '[name="toSend"]' ).value
      } );
    };

    // Helper to render current selection from AHK globals
    async function renderSelection () {
      try {
        const fileName = await ahk.global.SelectedFileName;
        const filePath = await ahk.global.SelectedFilePath;
        document.querySelector( '#sel-name' ).innerText = fileName && fileName.trim() ? fileName : '(none)';
        document.querySelector( '#sel-path' ).innerText = filePath && filePath.trim() ? filePath : '(no path)';
      } catch ( e ) {
        // ignore if globals not yet available
      }
    }

    // Initial render and expose updater for AHK to call
    await renderSelection();
    window.updateSelectedFromAhk = renderSelection;

    // Enable/disable delete button based on selection and wire click
    const btnDelete = document.querySelector( '#btn-delete' );
    async function updateDeleteState () {
      try {
        const filePath = await ahk.global.SelectedFilePath;
        btnDelete.disabled = !( filePath && filePath.trim() );
      } catch { }
    }
    await updateDeleteState();
    // Reuse existing updater to also update button state
    const oldUpdater = window.updateSelectedFromAhk;
    window.updateSelectedFromAhk = async function () {
      await oldUpdater();
      await updateDeleteState();
    };

    btnDelete.addEventListener( 'click', async () => {
      try {
        await ahk.global.DeleteSelected();
      } catch ( e ) {
        console.error( 'DeleteSelected failed', e );
      }
    } );
  </script>
</body>

</html>